angular.module("myApp",["ngRoute","myController","ngSanitize"]).config(["$routeProvider",function(a){a.when("/index",{templateUrl:"client/frontend/build/html/index.html",controller:"indexController"}).when("/preference",{templateUrl:"client/frontend/build/html/preference.html",controller:"preController"}).when("/:type",{templateUrl:"client/frontend/build/html/type.html",controller:"mliController"}).when("/:type/:id",{templateUrl:"client/frontend/build/html/detail.html",controller:"detailController"}).otherwise({redirectTo:"/index"})}]).service("ifLogin",function(){this.keepLogin=function(){var a=$(".navbar-nav.navbar-right");a.children().first().removeClass("hide").show(),a.children().eq(1).hide(),a.children().eq(2).hide(),$(".navbar-nav.navbar-right li.dropdown>a").html($.cookie("user_name")+'<span class="glyphicon glyphicon-menu-down"></span>')}}).service("loginOut",function(){this.loginOut=function(){var a=$(".navbar-nav.navbar-right");a.children().first().hide(),a.children().eq(1).show(),a.children().eq(2).show()}}).run(["$rootScope","$http","loginOut",function(a,b,c){a.loginOut=function(){c.loginOut(),b({method:"get",url:"client/backend/php/loginOut.php",params:{user_name:$.cookie("user_name")}}).success(function(a){}).error(function(a){})}}]).run(["$rootScope","$http",function(a,b){a.ifSci=a.ifEco=a.ifEdu=a.ifSpo=a.ifMli=!0,b({method:"get",url:"client/backend/php/getPre.php",params:{user_name:$.cookie("user_name")}}).success(function(b){0===b.code?(b.data.indexOf("sci")>=0?a.ifSci=!0:a.ifSci=!1,b.data.indexOf("eco")>=0?a.ifEco=!0:a.ifEco=!1,b.data.indexOf("edu")>=0?a.ifEdu=!0:a.ifEdu=!1,b.data.indexOf("spo")>=0?a.ifSpo=!0:a.ifSpo=!1,b.data.indexOf("mli")>=0?a.ifMli=!0:a.ifMli=!1):b.code}).error(function(a){})}]);var myController=angular.module("myController",[]);myController.controller("mliController",["$scope","$http","$routeParams","$location","$rootScope","ifLogin",function(a,b,c,d,e,f){e.orderProp="-time",a.type=c.type,a.count=1,a.hintMessage="显示更多新闻",void 0!==a.type&&b({method:"get",url:"client/backend/php/showList.php",params:{type:a.type,count:a.count}}).success(function(b){b.ifLogin&&f.keepLogin(),a.articles=b.list}).error(function(a){console.log("error messgae:"+a)}),a.getNext=function(){b({method:"get",url:"client/backend/php/showList.php",params:{type:a.type,count:a.count+1}}).success(function(b){a.articles=a.articles.concat(b.list),a.count++,b.num<10&&(a.hintMessage="没有更多新闻了")}).error(function(a){console.log("error messgae:"+a)})},a.getDetail=function(b){d.path(a.type+"/"+b.id)}}]),myController.controller("indexController",["$scope","$http","ifLogin","$location",function(a,b,c,d){b({method:"get",url:"client/backend/php/showHot.php"}).success(function(b){b.ifLogin&&c.keepLogin(),a.hots=b.hots,a.hots.forEach(function(b,c,d){switch(a.hots[c].type){case"mli":a.hots[c].typeCn="军事新闻";break;case"edu":a.hots[c].typeCn="教育新闻";break;case"sci":a.hots[c].typeCn="科技新闻";break;case"eco":a.hots[c].typeCn="经济新闻";break;case"spo":a.hots[c].typeCn="体育新闻";break;default:a.hots[c].typeCn="其他新闻"}}),b.mlis.name="军事",b.scis.name="科技",b.edus.name="教育",b.spos.name="体育",b.ecos.name="经济",a.types=[],a.types.push(b.mlis,b.scis,b.edus,b.spos,b.ecos,b.hots)}).error(function(a){console.log("error messgae:"+a)}),a.getDetail=function(a,b){d.path(b+"/"+a.id)}}]),myController.controller("detailController",["$scope","$http","$routeParams","ifLogin",function(a,b,c,d){b({method:"get",url:"client/backend/php/getDetail.php",params:{id:c.id,type:c.type}}).success(function(b){b.ifLogin&&d.keepLogin(),a.news=b}).error(function(a){console.log("error messgae:"+a)})}]),myController.controller("preController",["$scope","$http","$routeParams","$rootScope",function(a,b,c,d){a.types=[{name:"军事",value:"mli"},{name:"科技",value:"sci"},{name:"教育",value:"edu"},{name:"体育",value:"spo"},{name:"经济",value:"eco"}];for(var e in a.types)a.types[e].ifCheck=!0;a.chooseAll=function(){for(var b in a.types)a.types[b].ifCheck=!0},a.notChooseAll=function(){for(var b in a.types)a.types[b].ifCheck=!1},a.apply=function(){var c=[];for(var e in a.types)a.types[e].ifCheck&&c.push(a.types[e].value);b({url:"client/backend/php/applyPre.php",method:"post",data:{pres:c,user_name:$.cookie("user_name")}}).success(function(a){a.data.indexOf("sci")>=0?d.ifSci=!0:d.ifSci=!1,a.data.indexOf("eco")>=0?d.ifEco=!0:d.ifEco=!1,a.data.indexOf("edu")>=0?d.ifEdu=!0:d.ifEdu=!1,a.data.indexOf("spo")>=0?d.ifSpo=!0:d.ifSpo=!1,a.data.indexOf("mli")>=0?d.ifMli=!0:d.ifMli=!1})}}]),$(document).ready(function(){$("#user_name").bind("blur",function(){var a=$("#user_name").val();if(a.length<6)return void $(".warn-info").first().text("* 用户名至少6位字符");$.ajax({url:"client/backend/php/checkUserName.php?user_name="+a,method:"get",success:function(a){a.num>0?$(".warn-info").first().text("* 用户名重复"):$(".warn-info").first().text("")}})}),$("#signUp input:eq(1)").bind("blur",function(){$(this).val().length<6?$(".warn-info:eq(1)").text("* 密码至少6位字符"):$(".warn-info:eq(1)").text("")}),$("#signUp input:eq(2)").bind("blur",function(){var a=$(this).val();$("#signUp input:eq(1)").val()!==a?$(".warn-info:eq(2)").text("* 密码不一致"):$(".warn-info:eq(2)").text("")}),$("#signUp input:eq(3)").bind("blur",function(){var a=$(this).val();a.match(/^\w+@\w+\.(com)$/)?$(".warn-info:eq(3)").text(""):$(".warn-info:eq(3)").text("* 不是有效邮箱"),$.ajax({url:"client/backend/php/checkEmail.php?email="+a,method:"get",success:function(a){a.num>0?$(".warn-info:eq(3)").text("* 邮箱已经被注册"):$(".warn-info:eq(3)").text("")}})}),$("#signUp .modal-footer button").eq(1).bind("click",function(){var a=!0,b=$("#user_name").val(),c=$("#signUp input:eq(1)").val(),d=$("#signUp input:eq(2)").val(),e=$("#signUp input:eq(3)").val();(b.length<6||c.length<6||d!==c)&&(a=!1);if(e.match(/^\w+@\w+\.(com)$/)||(a=!1),!a)return void $("#signUp .modal-footer span").text("* 信息不完整或不合法");$("#signUp .modal-footer span").text(""),$.ajax({url:"client/backend/php/up.php",method:"post",datatype:JSON,data:{user_name:b,password:c,email:e},success:function(a){0===a.code?(alert("注册成功"),$("#signUp").modal("hide")):$("#signUp .modal-footer span").text("* 注册失败")}})}),$("#signIn .modal-body input").first().bind("blur",function(){if(0===$(this).val().length)return void $("#signIn .warn-info").first().text("* 邮箱不得为空");$("#signIn .warn-info").first().text("");var a=$(this).val();a.match(/^\w+@\w+\.(com)$/)?$(this).next().text(""):$(this).next().text("* 不是有效邮箱")}),$("#signIn .modal-body input:eq(1)").bind("blur",function(){0===$(this).val().length?$(this).next().text("* 密码不得为空"):$(this).next().text("")}),$("#signIn .modal-footer button:eq(1)").bind("click",function(){var a=$("#signIn .modal-body input").first().val(),b=$("#signIn .modal-body input:eq(1)").val();a&&a.match(/^\w+@\w+\.(com)$/)&&b?$("#signIn .modal-footer .warn-info").text(""):$("#signIn .modal-footer .warn-info").text("* 信息不完整或不合法"),$.ajax({url:"client/backend/php/in.php",method:"post",datatype:JSON,data:{password:b,email:a},success:function(a){if(0===a.code){alert("登录成功");var b=$(".navbar-nav.navbar-right");b.children().first().removeClass("hide").show(),b.children().eq(1).hide(),b.children().eq(2).hide(),$(".navbar-nav.navbar-right li.dropdown>a").html(a.data.user_name+'<span class="glyphicon glyphicon-menu-down"></span>'),$.cookie("user_name",a.data.user_name),$("#signIn").modal("hide")}else $("#signIn").find(".warn-info").last().text("* "+a.msg)}})})});